function Create-User {
Write-Host " "
Write-Host "---------- Create a new user ---------- "
Write-Host " "
Write-Host " "
$ticket = Read-Host "Starter form ticket number"
Write-Host " "
$firstname = Read-Host "Firstname"
$lastname = Read-Host "Lastname"
$jobtitle = Read-Host "Job Title"
$dept = Read-Host "Department"
$manager = Read-Host "Users Manager  (firstname.lastname)"
Write-Host " "
Write-Host " "
Write-Host "---------- Phones ----------"
Write-Host " "
Write-Host " "
$tel = Read-Host "Teams number (last 4 digits only)"
$mob = Read-Host "Mobile number"
Write-Host " "
Write-Host " "
Write-Host "---------- Folder Access ----------"
Write-Host " "
Write-Host " "
$copyaccessfrom = Read-Host "Copy file share access from who?  (firstname.lastname)"
Write-Host " "
Write-Host " "
Write-Host "---------- Leaving Date ----------"
Write-Host " "
Write-Host " "
$enddate = Read-Host "Leaving date  (MM/DD/YYYY) add 1 day extra"
Write-Host " "
Write-Host " "
   
   
   

    $sam = $firstname.ToLower() + "." + $lastname.ToLower()

    Write-Host "Creating user $sam.."
    Write-Host " "

    $date = get-date

    $Password = ([char[]]([char]33..[char]95) + ([char[]]([char]97..[char]126)) + 0..16 | sort {Get-Random})[0..16] -join '' | ConvertTo-SecureString -AsPlainText -Force

    $newuser = @{
            displayname = $firstname + " " + $lastname
            name = $firstname + " " + $lastname
            samaccountname = $sam
	        givenname = $firstname
	        surname = $lastname
	        company = "Company"
	        officephone = "+ $tel"
            mobile = $mobile
            manager = $manager
	        path = "OU=,OU=Managed Users,DC=,DC=,DC="
	        title = $jobtitle
            department = $dept
	        description = "Account created on $date by $env:USERNAME (T# $ticket )"
	        userprincipalname = "$sam@"
	        EmailAddress = "$sam@"
	        enabled = $true
	        accountpassword = $password
	        Otherattributes = @{proxyAddresses = ("SMTP:$sam" + "@"), ("SIP:$sam" + "@")}
		    }
 new-aduser @newuser

start-sleep -s 3

Set-ADAccountExpiration -identity $sam -DateTime $enddate

add-adgroupmember -identity "License - Enterprise Mobility Security E5" "$sam"

add-adgroupmember -identity "License - Microsoft Office 365 E5" "$sam"

add-adgroupmember -identity sec-proxy-user "$sam"

add-adgroupmember -identity sec_proxy-sync "$sam"

add-adgroupmember -identity "License - Microsoft 365 Domestic Calling Plan" "$sam"

add-adgroupmember -identity AIP "$sam"

add-adgroupmember -identity "Smartway2 Users" "$sam"

add-adgroupmember -identity "Intune-users" "$sam"

add-adgroupmember -identity "Windows Server 2019 - User" "$sam"

add-adgroupmember -identity "Zoom Outlook Users" "$sam"

add-adgroupmember -identity "Zoom Meeting Organisers" "$sam"

Add-ADGroupMember -identity sec-FSLogix-Teams "$sam"

Add-ADGroupMember -identity Exclaimer_AD_All_Staff "$sam"


Get-ADUser -Identity $copyaccessfrom -Properties memberof |
Select-Object -ExpandProperty memberof |
Add-ADGroupMember -Members $sam

 Write-Host ""
 Write-Host "Account created for $sam"
 Write-Host " "

 start-sleep -s 5

Invoke-Command -ComputerName core-aadc-01 -ScriptBlock {sync}

}


function Copy-Group {
[cmdletbinding()]
param(
      [Parameter(Mandatory=$True)]
      [string]$from,

      [Parameter(Mandatory=$True)]
      [string]$to
)

Get-ADUser -Identity $from -Properties memberof |
Select-Object -ExpandProperty memberof |
Add-ADGroupMember -Members $to

}


function Create-Adminuser {

    param(
          [Parameter(Mandatory=$True)]
          [string]$firstname,

          [Parameter(Mandatory=$True)]
          [string]$lastname

    )

$Password = ([char[]]([char]33..[char]95) + ([char[]]([char]97..[char]126)) + 0..16 | sort {Get-Random})[0..16] -join '' | ConvertTo-SecureString -AsPlainText -Force

    $params = @{

        displayname = $firstname + " " + $lastname
        name = $firstname + " " + $lastname
	    samaccountname = "adminqnrl" + $firstname.ToLower()[0] + $lastname.ToLower()[0]
	    givenname = $firstname
	    surname = $lastname
	    path = "OU=Admin Accounts,OU=Managed Users,DC=,DC=,DC="
	    userprincipalname = "adminqnrl" + $firstname.ToLower()[0] + $lastname.ToLower()[0] + "@"
	    enabled = $true
	    accountpassword = $password
    }
new-aduser @params

}

