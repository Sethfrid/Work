<#
.\SYNOPSIS
    Creates a new user and copy group members from one profile to another profile

.\DESCRIPTION
    Creates a new user and copies and only adds the group members that are NOT appearing on the 2nd user's profile. The function add-group is for adding a single group to user(s) at a time.

.\NOTES
    Author: Ben Lam
    Last Edit: 24 April 2018.

#>

# Creation of a new user

function new-user {

    param(
          [Parameter(Mandatory=$True)]
          [string]$firstname,

          [Parameter(Mandatory=$True)]
          [string]$lastname,

          [Parameter(Mandatory=$True)]
          [string]$jobtitle,

          [Parameter(Mandatory=$True)]
          [string]$tel

    )

    $sam = $firstname + "." + $lastname

    $samn = $sam.ToLower()

    $domain = "@domain"

    $params = @{
            displayname = $firstname + " " + $lastname
            name = $firstname + " " + $lastname
            samaccountname = $samn
                    givenname = $firstname
                    surname = $lastname
                    company = "UK Finance"
                    officephone = $tel
                    path = "OU=Users,OU=Managed Users,DC=domain,DC=org,DC=uk"
                    title = $jobtitle
                    description = $jobtitle
                    userprincipalname = $samn + $domain
                    EmailAddress = $samn + $domain
                    enabled = $true
                    accountpassword = (ConvertTo-SecureString -AsPlainText "Password1!" -Force)
                    Otherattributes = @{proxyAddresses = ("SMTP:$samn" + "$domain"), ("SIP:$samn" + "$domain")}
    } 

}

new-aduser @params



# Copying group members from one user to another

function member-copy {

param(
      [Parameter(Mandatory=$True,
      HelpMessage = "Enter the SAMACCOUNTNAME of the first user to copy from")]
      [string]$user1,

      [Parameter(Mandatory=$True,
      HelpMessage = "Enter the SAMACCOUNTNAME of the second user to copy to")]
      [string]$user2
)

Get-ADUser -Identity $user1 -Properties memberof |
Select-Object -ExpandProperty memberof |
Add-ADGroupMember -Members $user2

}

# For single use adding group members to users
function add-group {

param(
      [Parameter(Mandatory=$True,
      HelpMessage = "Enter the group name to add members to the users .Use "" if the name has spaces. Common groups: sec-emsE5, sec-o365, sec_proxy-sync, sec-proxy-user, 'Scaled Desktop Dynamic'")]
      [string]$group,

      [Parameter(Mandatory=$True,
      HelpMessage = "Enter the SAMACCOUNTNAME of the user to add to the group using a comma , to separate the names")]
      [string[]]$user


)

add-adgroupmember $group $user

}


# creating admin account
function new-adminuser {

    param(
          [Parameter(Mandatory=$True)]
          [string]$firstname,

          [Parameter(Mandatory=$True)]
          [string]$lastname

    )

    $sam = "admin"

    $domain = "@domain"

    $params = @{

            displayname = $firstname + " " + $lastname
            name = $firstname + " " + $lastname
                samaccountname = $sam + $firstname.ToLower()[0] + $lastname.ToLower()[0]
                givenname = $firstname
                surname = $lastname
                path = "OU=Users,OU=Managed Users,DC=domain,DC=org,DC=uk"
                userprincipalname = $sam + $firstname.ToLower()[0] + $lastname.ToLower()[0] + $domain
                enabled = $true
                accountpassword = (ConvertTo-SecureString -AsPlainText "Password1!" -Force)
    }

}

new-aduser @params

