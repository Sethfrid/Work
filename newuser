function Create-User {
$ticket = Read-Host "Enter Connect Wise ticket number"
$firstname = Read-Host "Enter first name"
$lastname = Read-Host "Enter surname"
$jobtitle = Read-Host "Title of New Starter"
$dept = Read-Host " Enter one of the numbers for the department

1 - 
2 - 
3 - 
4 - 
5 - 
"

$manager = Read-Host "Enter the manager's username"
Write-Host " "
Write-Host "---------- Phones ----------"
Write-Host " "
$tel = Read-Host "Enter 1 if user is an intern/ short term otherwise enter 2"
$phone = Read-Host "Enter last 4 digits"
$mob = Read-Host "Enter a mobile number"
Write-Host " "
Write-Host "---------- Folder Access ----------"
Write-Host " "
$copyaccessfrom = Read-Host "Copy file share access from who?  (firstname.lastname)"
Write-Host " "
Write-Host "---------- Leaving Date ----------"
Write-Host " "
$enddate = Read-Host "Leaving date  (MM/DD/YYYY) add 1 day extra"
Write-Host " "
Write-Host " "
   
   
   

    $sam = $firstname.ToLower() + "." + $lastname.ToLower()

    Write-Host "Creating user $sam.."
    Write-Host " "

    $date = get-date

    $Password = ([char[]]([char]33..[char]95) + ([char[]]([char]97..[char]126)) + 0..16 | sort {Get-Random})[0..16] -join '' | ConvertTo-SecureString -AsPlainText -Force

    $newuser = @{
            displayname = $firstname + " " + $lastname
            name = $firstname + " " + $lastname
            samaccountname = $sam
	        givenname = $firstname
	        surname = $lastname
	        company = "Company"
	        department = switch ($dept) 
            {

            1 {""}

            2 {""}

            3 {""}

            4 {""}

            5 {""}

            }
            mobile = $mobile
            manager = $manager
	        path = "OU=Angel Court Users,OU=Managed Users,DC=,DC=,DC="
	        title = $jobtitle
            officephone = switch ($dept)
            {

            1 {"+44 20 4582 $phone"}

            2 {"+44 20 3934 $phone"}

            }
	        description = "Account created on $date by $env:USERNAME (T# $ticket )"
	        userprincipalname = "$sam@domain"
	        EmailAddress = "$sam@domain"
	        enabled = $true
	        accountpassword = $password
	        Otherattributes = @{proxyAddresses = ("SMTP:$sam" + "@domain"), ("SIP:$sam" + "@domain")}
		    }
 new-aduser @newuser

start-sleep -s 3

Set-ADAccountExpiration -identity $sam -DateTime $enddate

add-adgroupmember -identity "License - Enterprise Mobility Security E5" "$sam"

add-adgroupmember -identity "License - Microsoft Office 365 E5" "$sam"

add-adgroupmember -identity sec-proxy-user "$sam"

add-adgroupmember -identity sec_proxy-sync "$sam"

add-adgroupmember -identity "License - Microsoft 365 Domestic Calling Plan" "$sam"

add-adgroupmember -identity AIP "$sam"

add-adgroupmember -identity "Smartway2 Users" "$sam"

add-adgroupmember -identity "Intune-users" "$sam"

add-adgroupmember -identity "Windows Server 2019 - User" "$sam"

add-adgroupmember -identity "Zoom Outlook Users" "$sam"

add-adgroupmember -identity "Zoom Meeting Organisers" "$sam"

Add-ADGroupMember -identity sec-FSLogix-Teams "$sam"

Add-ADGroupMember -identity Exclaimer_AD_All_Staff "$sam"

Add-ADGroupMember -identity user-salesforce "$sam"


Get-ADUser -Identity $copyaccessfrom -Properties memberof |
Select-Object -ExpandProperty memberof |
Add-ADGroupMember -Members $sam

 Write-Host ""
 Write-Host "Account created for $sam"
 Write-Host " "

 start-sleep -s 5

Invoke-Command -ComputerName core-aadc-01 -ScriptBlock {sync}

}





